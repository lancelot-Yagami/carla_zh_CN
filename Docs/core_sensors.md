# 4th. Sensors and data

传感器是从周围环境中检索数据的参与者。 它们对于为驾驶代理创建学习环境至关重要。

本页总结了开始处理[sensors reference](ref_sensors.md)的一切。 它介绍了可用的类型及其生命周期的分步指南。

 .

* [__Sensors step-by-step__](#sensors-step-by-step)  
	*   [Setting](#setting)  
	*   [Spawning](#spawning)  
	*   [Listening](#listening)  
	*   [Data](#data)  
* [__Types of sensors__](#types-of-sensors)  
	*   [Cameras](#cameras)  
	*   [Detectors](#detectors)  
	*   [Other](#other)  

---
## Sensors step-by-step  

[carla.Sensor](python_api.md#carla.Sensor) 定义了一种特殊类型的参与者，能够测量和流式传输数据.  

* __这是什么数据?__ 根据传感器的类型，它变化很大。 所有类型的数据都继承自通用 [carla.SensorData](python_api.md#carla.SensorData). 
* __他们什么时候检索数据?__ 在每个模拟步骤或注册某个事件时。 取决于传感器的类型. 
* __他们如何检索数据?__  每个传感器都有一个`listen()` 方法来接收和管理数据.  

尽管存在差异，但所有传感器都以相似的方式使用. 

### Setting
与其他所有参与者一样，找到蓝图并设置特定属性。 这在处理传感器时至关重要。 它们的属性将决定获得的结果。 这些在 [传感器参考](ref_sensors.md) 中有详细说明。 

以下示例设置仪表板高清摄像头.

```py
# Find the blueprint of the sensor.
blueprint = world.get_blueprint_library().find('sensor.camera.rgb')
# Modify the attributes of the blueprint to set image resolution and field of view.
blueprint.set_attribute('image_size_x', '1920')
blueprint.set_attribute('image_size_y', '1080')
blueprint.set_attribute('fov', '110')
# Set the time in seconds between sensor captures
blueprint.set_attribute('sensor_tick', '1.0')
``` 

### Spawning

`attachment_to` and `attachment_type`, 至关重要。 传感器应该连接到父参与者（通常是车辆）上，以跟随它并收集信息。 附件类型将确定其位置关于所述车辆的更新方式. 

* __刚性附件.__ 运动对其父位置非常严格。 这是从模拟中检索数据的正确附件.  
* __弹簧臂附件.__ 运动很轻松，加速和减速很少。 此附件仅推荐用于录制模拟视频。 移动是平滑的，并且在更新摄像机位置时避免了“跳跃”.  

```py
transform = carla.Transform(carla.Location(x=0.8, z=1.7))
sensor = world.spawn_actor(blueprint, transform, attach_to=my_vehicle)
```
!!! Important
    When spawning with attachment, location must be relative to the parent actor.  

### Listening

每个传感器都有一个 [`listen()`](python_api.md#carla.Sensor.listen) 方法. 每次传感器检索数据时都会调用它.  

参数 `callback` 是一个  [lambda function](https://www.w3schools.com/python/python_lambda.asp). 它描述了传感器在检索数据时应该做什么。 这必须将检索的数据作为参数.  

```py
# do_something() will be called each time a new image is generated by the camera.
sensor.listen(lambda data: do_something(data))

...

# This collision sensor would print everytime a collision is detected. 
def callback(event):
    for actor_id in event:
        vehicle = world_ref().get_actor(actor_id)
        print('Vehicle too close: %s' % vehicle.type_id)

sensor02.listen(callback)
```

### Data

大多数传感器数据对象都具有将信息保存到磁盘的功能。 这将允许它在其他环境中使用.  
传感器类型之间的传感器数据差异很大。 查看 [传感器参考](ref_sensors.md) 以获得详细说明。 但是，所有这些都总是带有一些基本信息的标记.

| 传感器数据属性                                                                  | 类型                                                                                   | 描述                                                                            |
| -------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| `frame`                                                                                | int                                                                                    | 	进行测量时的帧数.                                          |
| `timestamp`                                                                            | double                                                                                 | 	自剧集开始以来以模拟秒为单位的测量时间戳|
| `transform`                                                                            | [carla.Transform](<../python_api#carlatransform>)                                      | 测量时传感器的世界参考.                          |

<br>



!!! Important
    `is_listening` 是一个 __sensor 属性__ ，可以随意启用/禁用数据监听。
     `sensor_tick` 是一个 __blueprint 属性__，用于设置接收数据之间的模拟时间。

---
## Types of sensors
 
### Cameras

从相机的角度拍摄世界。 对于返回 [carla.Image](<../python_api#carlaimage>) 的相机，您可以使用帮助器类 [carla.ColorConverter](python_api.md#carla.ColorConverter) 来修改图像以表示不同的信息。

* * __检索__ 每个模拟步骤的数据。 


|传感器 |输出 | 概述       |
| ----------------- | ---------- | ------------------ |
| Depth | [carla.Image](<../python_api#carlaimage>)  |在灰度图中渲染视场中元素的深度.          |
| RGB      | [carla.Image](<../python_api#carlaimage>)   | 提供对周围环境的清晰视野。 看起来像一张普通的现场照片.   |
| Optical Flow    | [carla.Image](<../python_api#carlaimage>)  | 	渲染来自相机的每个像素的运动.  |
| Semantic segmentation    | [carla.Image](<../python_api#carlaimage>)  | 根据标签以特定颜色渲染视野中的元素. |
| DVS    | [carla.DVSEventArray](<../python_api#carladvseventarray>)  | 作为事件流异步测量亮度强度的变化.  |

<br>



---
### Detectors

当它们附加到的对象注册特定事件时检索数据。.  

*  触发时 __检索数据__ .  

| 传感器                                                                                                                                                                                          | 输出                                                                                                                                                                                          | 概述                                                                                                                                                                                        |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Collision                                                                   | [carla.CollisionEvent](<../python_api#carlacollisionevent>)                 | 检索其父actor和其他actor之间的碰撞.                   |
| Lane invasion                                                               | [carla.LaneInvasionEvent](<../python_api#carlalaneinvasionevent>)           | 在其父项越过车道标记时注册.                           |
| Obstacle                                                                    | [carla.ObstacleDetectionEvent](<../python_api#carlaobstacledetectionevent>) | 检测到其父级之前可能存在的障碍.                             |

<br>



### Other

检测到其父级之前可能存在的障碍.  

* __检索__ 每个模拟步骤的数据.  

| 传感器                                                                                                                                                                                          | 输出                                                                                                                                                                                          | 概述                                                                                                                                                                                        |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GNSS                                                                                                                                                                                            | [carla.GNSSMeasurement](<../python_api#carlagnssmeasurement>)                                                                                                                                   | 检索传感器的地理位置.                                                                                                                                                        |
| IMU                                                                                                                                                                                             | [carla.IMUMeasurement](<../python_api#carlaimumeasurement>)                                                                                                                                     | 包括加速度计、陀螺仪和指南针.                                                                                                                                         |
| LIDAR                                                                                                                                                                                           | [carla.LidarMeasurement](<../python_api#carlalidarmeasurement>)                                                                                                                                 | 旋转激光雷达。 生成一个 4D 点云，每个点的坐标和强度对周围环境进行建模.                                                                                |
| Radar                                                                                                                                                                                           | [carla.RadarMeasurement](<../python_api#carlaradarmeasurement>)                                                                                                                                 | 22D 点图建模元素在视线内及其与传感器有关的运动.                                                                                                               |
| RSS                                                                                                                                                                                             | [carla.RssResponse](<../python_api#carlarssresponse>)                                                                                                                                           | 根据安全检查修改应用于车辆的控制器。 这个传感器的工作方式与其他传感器不同，并且有专门的 [RSS 文档](<../adv_rss>) 用于它。|
| Semantic LIDAR                                                                                                                                                                                  | [carla.SemanticLidarMeasurement](<../python_api#carlasemanticlidarmeasurement>)                                                                                                                 | 旋转激光雷达。 生成具有有关实例和语义分割的额外信息的 3D 点云.                                                                               |

<br>



---
这是对传感器的总结，以及这些传感器如何检索模拟数据.  

至此，对 CARLA 的介绍结束。然而，还有很多东西要学.

* __继续学习.__ CARLA 中有一些高级功能：渲染选项、流量管理器、记录器等等。这是了解更多关于他们的好时机. 
 
<div class="build-buttons">
<p>
<a href="../adv_synchrony_timestep" target="_blank" class="btn btn-neutral" title="Synchrony and time-step">
Synchrony and time-step</a>
</p>
</div>

* __自由实验.__ 查看本文档的 __参考__ 部分。它包含有关 Python API 中的类、传感器、代码片段等的详细信息. 

<div class="build-buttons">
<p>
<a href="../python_api" target="_blank" class="btn btn-neutral" title="Python API reference">
Python API reference</a>
</p>
</div>


* __提出你的意见.__ 欢迎在论坛中提出任何疑问、建议和想法.

<div class="build-buttons">
<p>
<a href="https://github.com/carla-simulator/carla/discussions/" target="_blank" class="btn btn-neutral" title="Go to the CARLA forum">
CARLA forum</a>
</p>
</div>



